'''Финальная задача: Анализ логов веб-сервера
Условие:
Вы — системный администратор, и вам нужно проанализировать лог-файл,
представленный в виде одной большой многострочной строки. Каждая строка в логе
имеет строгий формат:
ГГГГ-ММ-ДД ЧЧ:ММ:СС УРОВЕНЬ: Сообщение

Некоторые сообщения об ошибках (ERROR) содержат в конце специальный код в
формате (code=XXX), где XXX — это число.

Ваша задача — написать функцию analyze_logs(log_data), которая обрабатывает
эти логи и возвращает список кодов критических ошибок по следующим правилам:

Выбрать только строки с уровнем логирования ERROR.

Из них выбрать только те, что произошли в утренние рабочие часы: с 08:00:00
включительно до 12:00:00 не включительно.

Из каждой подходящей по времени и уровню строки нужно извлечь код ошибки.
Если в сообщении нет (code=...), такая строка игнорируется.

Коды ошибок нужно преобразовать в целые числа.

Вернуть итоговый список кодов, отсортированный по убыванию.

Важно: Решение должно быть написано в функциональном стиле с использованием
"ленивых" вычислений, без создания больших промежуточных списков.

Формат входных данных:
Функция получает один аргумент log_data — многострочную строку.

Формат выходных данных:
Функция должна вернуть список (list) целых чисел.

Sample Input (передается в функцию как аргумент):

2025-11-15 08:30:15 ERROR: Service unavailable (code=500)
2025-11-15 09:15:40 ERROR: Not found (code=404)
2025-11-15 11:55:10 INFO: User logged in
2025-11-15 14:05:00 ERROR: Service overloaded (code=503)
2025-11-15 10:00:00 ERROR: Access denied (permission denied)


Sample Output (что должна вернуть функция):

[500, 404]


Комментарий к Sample:

Строка с INFO отфильтрована.

Строка с ERROR в 14:05:00 отфильтрована по времени.

Строка с ERROR "permission denied" отфильтрована, так как не содержит кода.

Остаются коды 500 и 404. После сортировки по убыванию получается [500, 404].'''


def analyze_logs(log_data: str) -> list[int]:
    """
    Анализирует многострочный лог и возвращает отсортированный
    список кодов ошибок по заданным правилам.
    """

    # Разбиваем входные данные на строки
    lines = log_data.splitlines()

    # Фильтруем строки, содержащие ERROR и code=, затем разбиваем каждую строку и берём дату, время и последний элемент (с кодом)
    # Генератор: разбивает строку, оставляет [дата, время, "(code=XXX)"]
    tmp = (line.split()[:2] + line.split()[-1:] for line in lines if 'ERROR' in line and 'code=' in line)

    # Фильтрация по времени: только с 08:00:00 до 12:00:00 (часы от 08 до 11 включительно)
    tmp = filter(lambda x: 8 <= int(x[1][:2]) < 12, tmp)

    # Извлекаем код из строки вида "(code=500)", удаляем скобку и преобразуем в int
    tmp = (int(i[2].split('=')[1].strip(')')) for i in tmp)

    # Преобразуем в список, сортируем по убыванию и возвращаем
    return sorted(list(tmp), reverse=True)


#
# log_ = (f'2025-11-15 08:30:15 ERROR: Service unavailable (code=500)\n'
#         f'2025-11-15 09:15:40 ERROR: Not found (code=404))\n'
#         f'2025-11-15 11:55:10 INFO: User logged in\n'
#         f'2025-11-15 14:05:00 ERROR: Service overloaded (code=503)\n'
#         f'2025-11-15 10:00:00 ERROR: Access denied (permission denied)')
#
# print(analyze_logs(log_))
